<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fashion AI Studio ‚Äî Generation History</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
body {
    margin:0;
    font-family: 'Inter', sans-serif;
    background: radial-gradient(circle at top, #1a1a1a, #050505);
    color:#fff;
}

header {
    padding:20px 60px;
    border-bottom:1px solid rgba(255,255,255,0.08);
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.container {
    max-width:1100px;
    margin:auto;
    padding:60px 20px;
}

h1 {
    font-family: 'Playfair Display', serif;
    margin-bottom:10px;
}

.summary {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:25px;
    margin-bottom:40px;
}

.summary-card {
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.08);
    border-radius:16px;
    padding:25px;
    text-align:center;
}

.summary-card h2 {
    margin:0;
    font-size:36px;
    color:#f5c26b;
}

.history-card {
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.08);
    border-radius:16px;
    padding:25px;
    margin-bottom:30px;
}

.history-header {
    display:flex;
    justify-content:space-between;
    margin-bottom:15px;
    opacity:0.8;
}

.image-grid {
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
    gap:15px;
}
.pagination-btn {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    color: white;
    padding: 10px 16px;
    margin: 6px;
    border-radius: 8px;
    cursor: pointer;
}

.pagination-btn.active {
    background: #f5c26b;
    color: black;
}

.pagination-btn:hover {
    border-color: #f5c26b;
}


.image-grid img {
    width:100%;
    border-radius:12px;
    background:#111;
    padding:8px;
}
</style>
</head>

<body>

<header>
    <h1>‚ú® Fashion AI Studio</h1>
    <a href="/api/" style="color:#f5c26b;text-decoration:none;">‚Üê Back to Studio</a>
</header>

<div class="container">

    <h1>Generation History</h1>

    <div class="summary">
        <div class="summary-card">
            <p>Total Images Generated</p>
            <h2 id="totalImages">0</h2>
        </div>
        <div class="summary-card">
            <p>Total Gemini Cost</p>
            <h2 id="totalCost">$0.00</h2>
        </div>
    </div>

    <div id="historyList"></div>
    <div id="pagination" style="text-align:center; margin-top:40px;"></div>


</div>

<!-- <script>
async function loadHistory() {
    const res = await fetch("/api/generation-history/");
    const data = await res.json();

    document.getElementById("totalImages").innerText = data.total_images;
    document.getElementById("totalCost").innerText = "$" + data.total_cost.toFixed(2);

    const historyList = document.getElementById("historyList");

    data.history.reverse().forEach(item => {
        const card = document.createElement("div");
        card.className = "history-card";

        const date = formatTimestamp(item.timestamp);

        card.innerHTML = `
            <div class="history-header">
                <div>üìÖ ${date}</div>
                <div>üñº ${item.generated_count} Images</div>
            </div>

            <p>Gender: <b>${item.gender}</b> | Bodytype: <b>${item.bodytype}</b></p>
            <p>Uploaded: ${item.uploaded_images.join(", ")}</p>

            <div class="image-grid">
                ${item.generated_images.map(img => `
                    <img src="/media/generated/${img}">
                `).join("")}
            </div>
        `;

        historyList.appendChild(card);
    });
}

function formatTimestamp(ts) {
    // Example: 20260119_023548
    const [datePart, timePart] = ts.split("_");

    const year = datePart.substring(0, 4);
    const month = datePart.substring(4, 6);
    const day = datePart.substring(6, 8);

    const hour = timePart.substring(0, 2);
    const minute = timePart.substring(2, 4);

    const dateObj = new Date(`${year}-${month}-${day}T${hour}:${minute}:00`);

    return dateObj.toLocaleString("en-IN", {
        day: "2-digit",
        month: "short",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        hour12: true
    });
}

loadHistory();
</script> -->

<script>
let historyData = [];
let currentPage = 1;
const pageSize = 5;

/* Format timestamp */
function formatTimestamp(ts) {
    const [datePart, timePart] = ts.split("_");
    const year = datePart.substring(0, 4);
    const month = datePart.substring(4, 6);
    const day = datePart.substring(6, 8);
    const hour = timePart.substring(0, 2);
    const minute = timePart.substring(2, 4);

    const dateObj = new Date(`${year}-${month}-${day}T${hour}:${minute}:00`);

    return dateObj.toLocaleString("en-IN", {
        day: "2-digit",
        month: "short",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        hour12: true
    });
}

/* Load history */
async function loadHistory() {
    const res = await fetch("/api/generation-history/");
    const data = await res.json();

    document.getElementById("totalImages").innerText = data.total_images;
    document.getElementById("totalCost").innerText = "$" + data.total_cost.toFixed(2);

    historyData = data.history.reverse(); // latest first
    renderPage(1);
}

/* Render page */
function renderPage(page) {
    currentPage = page;
    const historyList = document.getElementById("historyList");
    historyList.innerHTML = "";

    const start = (page - 1) * pageSize;
    const end = start + pageSize;
    const pageItems = historyData.slice(start, end);

    pageItems.forEach(item => {
        const card = document.createElement("div");
        card.className = "history-card";

        const date = formatTimestamp(item.timestamp);

        card.innerHTML = `
            <div class="history-header">
                <div>üìÖ ${date}</div>
                <div>üñº ${item.generated_count} Images</div>
            </div>

            <p>
                üë§ User: <b>${item.user}</b>
                &nbsp; | &nbsp;
                Gender: <b>${item.gender}</b>
                &nbsp; | &nbsp;
                Bodytype: <b>${item.bodytype}</b>
            </p>

            <p>üì§ Uploaded: ${item.uploaded_images.join(", ")}</p>
        `;

        historyList.appendChild(card);
    });

    renderPagination();
}

/* Render pagination */
function renderPagination() {
    const totalPages = Math.ceil(historyData.length / pageSize);
    const pagination = document.getElementById("pagination");
    pagination.innerHTML = "";

    if (totalPages <= 1) return;

    for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.className = "pagination-btn" + (i === currentPage ? " active" : "");
        btn.innerText = i;

        btn.onclick = () => renderPage(i);
        pagination.appendChild(btn);
    }
}

loadHistory();
</script>

</body>
</html>
